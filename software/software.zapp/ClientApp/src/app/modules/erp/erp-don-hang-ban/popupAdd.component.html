<div
    class="flex flex-col flex-auto w-full mx-auto h-fit overflow-y-visible mobile:mb-20"
>
    <!-- Header -->
    <div
        class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary"
    >
        <div class="text-lg font-medium" transloco="NAV.erp_don_hang_ban"></div>
    </div>
    <!-- Card Form -->
    <div class="w-full p-6 sm:p-8 space-y-1 overflow-y-auto">
        <!-- Action -->
        <div class="flex flex-row justify-end space-x-2">
            <button
                class="rounded py-2 px-4 font-bold bg-gray-500 hover:bg-gray-600 items-center"
                (click)="save()"
            >
                <p transloco="common.save" class="mb-0 text-white"></p>
            </button>
            <button
                class="py-2 px-4 font-bold rounded bg-teal-500 hover:bg-teal-600 items-center"
                (click)="close()"
            >
                <p transloco="common.close" class="mb-0 text-white"></p>
            </button>
        </div>
        <div class="mb-2">
            <!-- Thông tin đơn hàng -->
            <ng-container>
                <h1 class="font-bold text-xl">Thông tin đơn hàng</h1>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.code"
                            [label]="'system.code'"
                            [keyError]="'db.code'"
                            [actionEnum]="3"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.loai_don_hang'"
                            [listData]="list_loai_don_hang"
                            [(model)]="record.db.loai_don_hang"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.loai_don_hang'"
                        ></cm_select>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.name"
                            [label]="'system.name'"
                            [keyError]="'db.name'"
                            [actionEnum]="3"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.note"
                            [label]="'system.note'"
                            [keyError]="'db.note'"
                            [type]="'textarea'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.ngay_dat_hang"
                            [label]="'system.ngay_dat_hang'"
                            [keyError]="'db.ngay_dat_hang'"
                            [type]="'datepicker'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.phuong_thuc_thanh_toan'"
                            [listData]="list_phuong_thuc_thanh_toan"
                            [(model)]="record.db.phuong_thuc_thanh_toan"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.phuong_thuc_thanh_toan'"
                        ></cm_select>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div
                        class="flex-1"
                        *ngIf="record.db.phuong_thuc_thanh_toan == 2"
                    >
                        <cm_select
                            [label]="'system.loai_chuyen_khoan'"
                            [listData]="list_loai_chuyen_khoan"
                            [(model)]="record.db.loai_chuyen_khoan"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.loai_chuyen_khoan'"
                        ></cm_select>
                    </div>
                    <div
                        class="flex-1"
                        *ngIf="record.db.loai_chuyen_khoan == 3"
                    >
                        <cm_select
                            [label]="'system.ngan_hang_nhan_tien'"
                            [listData]="list_ngan_hang"
                            [(model)]="record.db.id_ngan_hang"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.loai_chuyen_khoan'"
                        ></cm_select>
                    </div>
                </div>
            </ng-container>
            <!-- Thông tin đơn vị vận chuyển -->
            <ng-container>
                <h1 class="font-bold text-xl">Thông tin đơn vị vận chuyển</h1>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.don_vi_van_chuyen'"
                            [listData]="list_don_vi_van_chuyen"
                            [(model)]="record.db.id_don_vi_van_chuyen"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.id_don_vi_van_chuyen'"
                        ></cm_select>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.ma_don_van_chuyen"
                            [label]="'system.ma_don_van_chuyen'"
                            [keyError]="'db.ma_don_van_chuyen'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="
                                record.db.thanh_tien_van_chuyen_truoc_thue
                            "
                            [label]="'system.thanh_tien_van_chuyen_truoc_thue'"
                            [keyError]="'db.thanh_tien_van_chuyen_truoc_thue'"
                            [type]="'number'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.ty_le_vat_van_chuyen'"
                            [listData]="list_vat"
                            [(model)]="record.db.id_ty_le_vat_van_chuyen"
                            [actionEnum]="actionEnum"
                            [callbackChange]="
                                change_ty_le_vat_van_chuyen.bind(this)
                            "
                            [errorModel]="errorModel"
                            [keyError]="'db.id_don_vi_van_chuyen'"
                        ></cm_select>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.tien_thue_van_chuyen"
                            [label]="'system.tien_thue_van_chuyen'"
                            [keyError]="'db.tien_thue_van_chuyen'"
                            [type]="'number'"
                            [actionEnum]="3"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.thanh_tien_van_chuyen_sau_thue"
                            [label]="'system.thanh_tien_van_chuyen_sau_thue'"
                            [keyError]="'db.thanh_tien_van_chuyen_sau_thue'"
                            [type]="'number'"
                            [actionEnum]="3"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.so_ngay_du_kien_giao"
                            [label]="'system.so_ngay_du_kien_giao'"
                            [keyError]="'db.so_ngay_du_kien_giao'"
                            [type]="'number'"
                            [callbackChange]="
                                change_ngay_du_kien_giao_hang.bind(this)
                            "
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.ngay_du_kien_giao"
                            [label]="'system.ngay_du_kien_giao'"
                            [keyError]="'db.ngay_du_kien_giao'"
                            [type]="'datepicker'"
                            [actionEnum]="3"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
            </ng-container>
            <!-- Thông tin khách hàng đặt -->
            <ng-container>
                <h1 class="font-bold text-xl">Thông tin khách hàng đặt</h1>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.tinh_khach_hang_dat'"
                            [listData]="list_tinh_thanh"
                            [(model)]="record.db.id_tinh_khach_hang_dat"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [callbackChange]="
                                change_quan_huyen_nguoi_dat.bind(this)
                            "
                            [keyError]="'db.id_quan_khach_hang_dat'"
                        ></cm_select>
                    </div>
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.quan_khach_hang_dat'"
                            [listData]="list_quan_huyen_dat"
                            [(model)]="record.db.id_quan_khach_hang_dat"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.id_quan_khach_hang_nhan'"
                        ></cm_select>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.dia_chi_cu_the_khach_hang_dat"
                            [label]="'system.dia_chi_cu_the_khach_hang_dat'"
                            [keyError]="'db.dia_chi_cu_the_khach_hang_dat'"
                            [type]="'textarea'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.first_name_khach_hang_dat"
                            [label]="'system.first_name_khach_hang_dat'"
                            [keyError]="'db.first_name_khach_hang_dat'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.last_name_khach_hang_dat"
                            [label]="'system.last_name_khach_hang_dat'"
                            [keyError]="'db.last_name_khach_hang_dat'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.email_khach_hang_dat"
                            [label]="'system.email_khach_hang_dat'"
                            [keyError]="'db.email_khach_hang_dat'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.phone_khach_hang_dat"
                            [label]="'system.phone_khach_hang_dat'"
                            [keyError]="'db.phone_khach_hang_dat'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
            </ng-container>
            <!-- Thông tin khách hàng nhận -->
            <ng-container>
                <h1 class="font-bold text-xl">Thông tin khách hàng nhận</h1>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.tinh_khach_hang_nhan'"
                            [listData]="list_tinh_thanh"
                            [(model)]="record.db.id_tinh_khach_hang_nhan"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [callbackChange]="
                                change_quan_huyen_nguoi_nhan.bind(this)
                            "
                            [keyError]="'db.id_tinh_khach_hang_nhan'"
                        ></cm_select>
                    </div>
                    <div class="flex-1">
                        <cm_select
                            [label]="'system.quan_khach_hang_nhan'"
                            [listData]="list_quan_huyen_nhan"
                            [(model)]="record.db.id_quan_khach_hang_nhan"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                            [keyError]="'db.id_quan_khach_hang_nhan'"
                        ></cm_select>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.dia_chi_cu_the_khach_hang_nhan"
                            [label]="'system.dia_chi_cu_the_khach_hang_nhan'"
                            [keyError]="'db.dia_chi_cu_the_khach_hang_nhan'"
                            [type]="'textarea'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.first_name_khach_hang_nhan"
                            [label]="'system.first_name_khach_hang_nhan'"
                            [keyError]="'db.first_name_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.last_name_khach_hang_nhan"
                            [label]="'system.last_name_khach_hang_nhan'"
                            [keyError]="'db.last_name_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.email_khach_hang_nhan"
                            [label]="'system.email_khach_hang_nhan'"
                            [keyError]="'db.email_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.phone_khach_hang_nhan"
                            [label]="'system.phone_khach_hang_nhan'"
                            [keyError]="'db.phone_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.email_khach_hang_nhan"
                            [label]="'system.email_khach_hang_nhan'"
                            [keyError]="'db.email_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                    <div class="flex-1">
                        <cm_input
                            [(model)]="record.db.phone_khach_hang_nhan"
                            [label]="'system.phone_khach_hang_nhan'"
                            [keyError]="'db.phone_khach_hang_nhan'"
                            [actionEnum]="actionEnum"
                            [errorModel]="errorModel"
                        ></cm_input>
                    </div>
                </div>
            </ng-container>
            <!-- Thông tin mặt hàng -->
            <ng-container>
                <h1 class="font-bold text-xl">Thông tin mặt hàng</h1>
                <div align="right" class="space-x-2">
                    <button
                        class="rounded py-2 px-4 font-bold bg-green-700 hover:bg-green-700 items-center"
                        (click)="chooseSanPham()"
                    >
                        <p
                            transloco="erp.chon_san_pham"
                            class="mb-0 text-white"
                        ></p>
                    </button>
                </div>
                <div
                    class="flex flex-col md:flex-row lg:flex-row md:space-x-4 flex-wrap"
                >
                    <table
                        datatable
                        style="width: 100% !important"
                        class="w-full cell-border myTable hover bg-primary-700"
                    >
                        <thead>
                            <tr>
                                <th style="min-width: 50px"></th>
                                <th transloco="erp.san_pham"></th>
                                <th transloco="erp.mau_sac"></th>
                                <th transloco="erp.size"></th>
                                <th transloco="erp.so_luong"></th>
                                <th transloco="erp.don_gia"></th>
                                <th transloco="erp.chiet_khau"></th>
                                <th transloco="erp.note"></th>
                            </tr>
                        </thead>
                        <ng-container *ngIf="record.list_detail?.length != 0">
                            <tbody>
                                <ng-container
                                    *ngFor="
                                        let item of record.list_detail;
                                        index as i
                                    "
                                >
                                    <tr>
                                        <td style="text-align: center">
                                            {{ i + 1 }}
                                        </td>
                                        <td>
                                            <a
                                                (click)="
                                                    openDialogDetail(item, i)
                                                "
                                                class="underline font-bold"
                                                style="color: #ef5425"
                                                >{{ item.ma_san_pham }}</a
                                            >
                                            <br />
                                            {{ item.ten_san_pham }}
                                            <br />{{ item.ten_nhan_hieu }}
                                            <br />{{ item.ten_loai_san_pham }}
                                        </td>
                                        <td>
                                            <span
                                                [style.color]="item.color_code"
                                                >{{ item.color }}</span
                                            >
                                        </td>
                                        <td>
                                            {{ item.size }}({{
                                                item.size_code
                                            }})
                                        </td>
                                        <td>
                                            <cm_input
                                                [(model)]="item.db.so_luong"
                                                [keyError]="'db.so_luong' + i"
                                                [actionEnum]="actionEnum"
                                                [errorModel]="errorModel"
                                            ></cm_input>
                                        </td>
                                        <td>
                                            {{ item.db.don_gia }}/{{
                                                item.ten_don_vi_tinh
                                            }}
                                        </td>
                                        <td>
                                            <cm_input
                                                [(model)]="
                                                    item.db.gia_tri_chiet_khau
                                                "
                                                [keyError]="
                                                    'db.gia_tri_chiet_khau' + i
                                                "
                                                [callbackChangeWithParamPos]="
                                                    change_callback_data_money_item_detail(
                                                        i
                                                    )
                                                "
                                                [actionEnum]="actionEnum"
                                                [errorModel]="errorModel"
                                            ></cm_input>
                                        </td>
                                        <td>
                                            <cm_select
                                                [listData]="list_vat"
                                                [(model)]="item.db.id_vat"
                                                [keyError]="'db.id_vat' + i"
                                                [actionEnum]="actionEnum"
                                                [errorModel]="errorModel"
                                            ></cm_select>
                                        </td>
                                        <td>
                                            <cm_input
                                                [(model)]="item.db.note"
                                                [keyError]="'db.note' + i"
                                                [actionEnum]="actionEnum"
                                                [errorModel]="errorModel"
                                            ></cm_input>
                                        </td>
                                    </tr>
                                    <tr
                                        class="border-b-2 border-indigo-500 italic ng-star-inserted"
                                    >
                                        <td align="center"></td>
                                        <td align="left" colspan="2">
                                            <span
                                                transloco="erp.thanh_tien_sau_chiet_khau"
                                                class="font-bold"
                                                >Thành tiền sau chiết khấu</span
                                            >:
                                            {{ item.db.thanh_tien_chiet_khau }}
                                        </td>
                                        <td align="left" colspan="1">
                                            <span
                                                transloco="erp.vat"
                                                class="font-bold"
                                                >VAT</span
                                            >(%):
                                            <span>
                                                {{ item.db.gia_tri_vat }}
                                            </span>
                                        </td>
                                        <td align="left" colspan="2">
                                            <span
                                                transloco="erp.tien_thue"
                                                class="font-bold"
                                                >Tiền thuế</span
                                            >: {{ item.db.thanh_tien_thue }}
                                        </td>
                                        <td align="left" colspan="3">
                                            <span
                                                transloco="erp.thanh_tien_sau_thue"
                                                class="font-bold"
                                                >Thành tiền sau thuế</span
                                            >: {{ item.db.thanh_tien_sau_thue }}
                                        </td>
                                    </tr>
                                </ng-container>
                                <tr class="mt-5">
                                    <td colspan="4" align="right">
                                        <span
                                            transloco="erp.chi_phi_van_chuyen"
                                            class="font-bold text-blue-600"
                                        ></span>
                                    </td>
                                    <td
                                        colspan="8"
                                        align="right"
                                        class="font-bold"
                                    >
                                        {{
                                            record.db
                                                .thanh_tien_van_chuyen_sau_thue
                                        }}
                                    </td>
                                </tr>
                                <tr class="mt-5">
                                    <td colspan="4" align="right">
                                        <span
                                            transloco="erp.tong_thanh_tien_sau_chiet_khau"
                                            class="font-bold text-blue-600"
                                        >
                                        </span>
                                    </td>
                                    <td
                                        colspan="8"
                                        align="right"
                                        class="font-bold"
                                    >
                                        {{ record.db.thanh_tien_chiet_khau }}
                                    </td>
                                </tr>
                                <tr class="mt-5">
                                    <td colspan="4" align="right">
                                        <span
                                            transloco="erp.tong_thanh_tien_thue"
                                            class="font-bold text-blue-600"
                                        ></span>
                                    </td>
                                    <td
                                        colspan="8"
                                        align="right"
                                        class="font-bold"
                                    >
                                        {{ record.db.tien_thue }}
                                    </td>
                                </tr>
                                <tr class="mt-5">
                                    <td colspan="4" align="right">
                                        <span
                                            transloco="erp.tong_thanh_tien_sau_thue"
                                            class="font-bold text-blue-600"
                                        >
                                        </span>
                                    </td>
                                    <td
                                        colspan="8"
                                        align="right"
                                        class="font-bold"
                                    >
                                        {{ record.db.thanh_tien_sau_thue }}
                                    </td>
                                </tr>
                            </tbody>
                        </ng-container>
                        <tbody *ngIf="record.list_detail?.length == 0">
                            <tr class="h-40">
                                <td colspan="100" class="no-data-available">
                                    <nz-empty
                                        nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
                                        [nzNotFoundContent]="contentNoData"
                                    >
                                        <ng-template #contentNoData>
                                            <span
                                                transloco="common.no_data"
                                            ></span>
                                        </ng-template>
                                    </nz-empty>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </ng-container>
            <br />
        </div>
        <!-- Action -->
        <div class="flex flex-row justify-end space-x-2">
            <button
                class="rounded py-2 px-4 font-bold bg-gray-500 hover:bg-gray-600 items-center"
                (click)="save()"
            >
                <p transloco="common.save" class="mb-0 text-white"></p>
            </button>
            <button
                class="py-2 px-4 font-bold rounded bg-teal-500 hover:bg-teal-600 items-center"
                (click)="close()"
            >
                <p transloco="common.close" class="mb-0 text-white"></p>
            </button>
        </div>
    </div>
</div>
